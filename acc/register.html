<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Form</title>
    <link rel="stylesheet" href="./forms.css" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../img/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../img/favicon//favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../img/favicon//favicon-16x16.png"
    />
  </head>
  <body>
    <div class="login-container">
      <div class="heading-container">
        <img
          src="../img/photofox-logo.png"
          width="30%"
          height="30%"
          alt="Logo"
        />
        <h2>Registration Photofox</h2>
        Schon registriert? <a href="./login.html">Anmelden</a>
      </div>
      <form action="./register.php" method="POST" id="registrationForm">
        <label for="name">Vollständiger Name</label>
        <input type="text" id="name" name="name" required />

        <label for="email">E-Mail</label>
        <input type="email" id="email" name="email" required />

        <label for="username">Nutzername</label>
        <input type="text" id="username" name="username" required />

        <label for="password">Passwort</label>
        <input type="password" id="password" name="password" required />
        <span id="passwordError" style="color: red;"></span>

        <label for="code">Einmalcode</label>
        <input
          type="text"
          id="code"
          inputmode="numeric"
          name="code"
          pattern="[a-zA-Z0-9äöüÄÖÜß_]{3}-[a-zA-Z0-9äöüÄÖÜß_]{3}"
          required
        />
        <span id="codeError" style="color: red;"></span>

        <button type="submit">Registrieren</button>
      </form>
    </div>
    <script>
        document.getElementById('registrationForm').addEventListener('submit', function(event) {
            const passwordInput = document.getElementById('password');
            const passwordError = document.getElementById('passwordError');

            if (!passwordInput.validity.valid) {
                passwordInput.setCustomValidity(getPassReq()[1]);
                passwordError.textContent = passwordInput.validationMessage;
                event.preventDefault();
            } else {
                passwordInput.setCustomValidity("");
                passwordError.textContent = "";
            }
        });

        // Überwachung der Eingabe für dynamische Fehleraktualisierung
        document.getElementById('password').addEventListener('input', function() {
            const passwordInput = document.getElementById('password');
            const passwordError = document.getElementById('passwordError');

            if (passwordInput.validity.valid) {
                passwordInput.setCustomValidity("");
                passwordError.textContent = "";
            } else {
                passwordError.textContent = passwordInput.validationMessage;
            }
        });

      async function getPassReq() {
        const file = '../configs/security-config.json';
        const key = 'pass-requirements';

        try {
          const response = await fetch(file);
          const config = await response.json();

          if (config.hasOwnProperty(key)) {
            return config[key];
          } else {
            const value = [
              "(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=!])(?=.{8,})", 
              "Mindestens 8 Zeichen, mit mindestens einem Großbuchstaben, einem Kleinbuchstaben, einer Zahl und einem Sonderzeichen"
            ];
            return value;
          }
        } catch (error) {
          console.error('Error loading config:', error);
          return [
              "(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=!])(?=.{8,})", 
              "Mindestens 8 Zeichen, mit mindestens einem Großbuchstaben, einem Kleinbuchstaben, einer Zahl und einem Sonderzeichen"
          ];
        }
      }
      document.getElementById('password').pattern = await getPassReq()[0];
      </script>
  </body>
</html>
